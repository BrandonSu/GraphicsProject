<script src=M.js></script>
<script src=lib2k.js></script>
<script src=SHAPE.js></script>

<body bgcolor=black text=white>
<center>
<canvas id='canvas1' width=600 height=600></canvas>
</center>
</body>
   
<script>

var vs = '\
attribute vec3 aPos, aNor;\n\
attribute vec2 aUV;\n\
varying   vec3 vPos, vNor;\n\
varying   vec2 vUV;\n\
uniform   mat4 matrix, invMatrix;\n\
void main() {\n\
   vec4 pos = matrix * vec4(aPos, 1.);\n\
   vec4 nor = vec4(aNor, 0.) * invMatrix;\n\
   gl_Position = pos;\n\
   vPos = pos.xyz;\n\
   vNor = nor.xyz;\n\
   vUV  = aUV;\n\
}\n\
';

var fs1 = '\
varying vec3 vPos, vNor;\n\
varying vec2 vUV;\n\
void main() {\n\
   vec3 normal = normalize(vNor);\n\
   vec3 c = vec3(.1,.1,.1);\n\
   c += vec3(.7,.7,1.) * max(0.,dot(normal, vec3( .7, .7, .7)));\n\
   c += vec3(.5,.3,.1) * max(0.,dot(normal, vec3(-.7,-.7,-.7)));\n\
   gl_FragColor = vec4(sqrt(c), 1.);\n\
}\n\
';

var fs2 = '\
varying vec3 vPos, vNor;\n\
varying vec2 vUV;\n\
uniform sampler2D uSampler;\n\
void main() {\n\
   vec3 normal = normalize(vNor);\n\
   vec3 c = vec3(.1,.1,.1);\n\
   c += vec3(.7,.7,1.) * max(0.,dot(normal, vec3( .7, .7, .7)));\n\
   c += vec3(.5,.3,.1) * max(0.,dot(normal, vec3(-.7,-.7,-.7)));\n\
   vec4 texture = texture2D(uSampler, vUV);\n\
   c *= texture.rgb;\n\
   gl_FragColor = vec4(sqrt(c), 1.);\n\
}\n\
';
    //Default Values
   var widthBody = .2;
   var heightBody = .1;
   //document.getElementById('canvas1').addEventListener("keydown", stretchBody);

   var widthHead = 0.12;
   var heightHead = 0.05;

   var heightCtr=0;
   var widthCtr=0;

   //Changing the body structure
   function stretchBody(e){
      if(e.keyCode == 38 && heightBody <= .5){   //Up Arrow : Taller
         heightBody += .1;
         heightHead+=.0005;
         heightCtr+=1;

      }
      if(e.keyCode == 40 && heightBody >= .2){   //Down Arrow : Shorter
         heightBody -= .1;
         heightHead -=.0005;
         heightCtr-=1;
      }
      if(e.keyCode == 37 && widthBody >= .2){    //Left Arrow : Skinny Down
         widthBody -= .1;
         widthHead -= .01;
         widthCtr+=1;
         console.log(widthBody);
      }
      if(e.keyCode == 39 && widthBody <= .5){    //Right Arrow : Grow fatter lol it me
         widthBody += .1;
         widthHead += .01;
         widthCtr-=1;
         console.log(widthBody);
      }
       armWidth=widthBody/10;
       armHeight=heightBody/1.5;
   }

   //materials and scene
   var material1 = new Material(vs, fs1);
   material1.setTexture('imgs/polkadots.jpg');
   var material2 = new Material(vs, fs2);
   material2.setTexture('imgs/brick.png');

   var scene = new Scene();

   //initialize body parts
   //BSU PUT HEAD HERE
   var head;
   var head2;
   var head3;
   var headMaterial;

   head = new SceneObject();
//  head2 = new SceneObject();
 //  head3 = new SceneObject();
   head.setVertices(SHAPE.cylinder(4));
   head.setMaterial(material2);
   
   scene.addObject(head);


   //torso   
   var body;
   var bodyMaterial;
   body = new SceneObject();
   bodyMaterial=material2;

   body.setVertices(SHAPE.cylinder(4)); //Gives a rectangular body
   body.setMaterial(bodyMaterial);
   scene.addObject(body);

   //limbs
   var leftArm = new SceneObject();
   var leftLeg = new SceneObject();
   var rightArm = new SceneObject();
   var rightLeg = new SceneObject();
   var armWidth = widthBody/10;
   var armHeight = heightBody/1.5;
   var legWidth = 0.05;
   var lArmMaterial = bodyMaterial;    //arms should have same material as body
   var rArmMaterial = bodyMaterial;
   var lLegMaterial = material1;
   var rLegMaterial = material1;

   leftArm.setVertices(SHAPE.cylinder(15));
   rightArm.setVertices(SHAPE.cylinder(15));
   leftLeg.setVertices(SHAPE.cylinder(15));
   rightLeg.setVertices(SHAPE.cylinder(15));
   leftArm.setMaterial(lArmMaterial);
   rightArm.setMaterial(rArmMaterial);
   leftLeg.setMaterial(lLegMaterial);
   rightLeg.setMaterial(rLegMaterial);
 //  scene.addObject(leftArm);
  // scene.addObject(rightArm);
   // scene.addObject(leftLeg);
   // scene.addObject(rightLeg);

   //scene
   canvas1.scene = scene;

   var m = M.identityMatrix();

   gl_start(canvas1,function(time) {
      document.addEventListener('keydown', stretchBody);
      M.identity(m);

      M.rotateY(m, time);
    //   M.rotateY(m, .75*Math.PI);

      //BSU PUT HEAD HERE
      M.save(m);
         M.scale(m, widthHead, heightHead, .4);
         M.rotateX(m, .5*Math.PI);
         M.rotateZ(m, .75*Math.PI);
     //    M.translate(m, [0.,0,0]);
         M.translate(m, [0,0,-2.7]);
         //M.translate(m, [.2*heightCtr,0,0]);
         M.translate(m, [0,0,-1.9*heightCtr]);
         //M.rotateZ(m,.05*heightCtr) //attempting to rotate the head so it remains like perpindicular kinda
         head.setMatrix(m);
      M.restore(m);




      //torso
      M.save(m);
         M.scale(m, widthBody, heightBody, .4);
         M.rotateX(m, .5*Math.PI);
         M.rotateZ(m, .75*Math.PI);
         body.setMatrix(m);
      M.restore(m);

      //limbs
      M.save(m);
         M.scale(m, armWidth, armWidth, armHeight);
         M.translate(m, [-8+widthBody+armWidth, 2, 0]);
         M.rotateX(m, 90);
         //M.rotateZ(m, 80);
         // M.rotateY(m, 90);
         leftArm.setMatrix(m);
      M.restore(m);

      M.save(m);
         M.scale(m, armWidth, armHeight, .1);
         M.translate(m, [8+widthBody+armWidth, 2, 0]);
         M.rotateX(m, 60);
         // M.rotateZ(m, 80);
         // M.rotateY(m, 90);
         rightArm.setMatrix(m);
      M.restore(m);

      // M.save(m);
      //    M.scale(m, armWidth, armHeight, .1);
      //    M.translate(m, [-8+widthBody+armWidth, heightBody, 0]);
      //    M.rotateX(m, 60);
      //    M.rotateZ(m, 80);
      //    // M.rotateY(m, 90);
      //    leftLeg.setMatrix(m);
      // M.restore(m);

      // M.save(m);
      //    M.scale(m, armWidth, armHeight, .1);
      //    M.translate(m, [-8+widthBody+armWidth, heightBody, 0]);
      //    M.rotateX(m, 60);
      //    M.rotateZ(m, 80);
      //    // M.rotateY(m, 90);
      //    rightLeg.setMatrix(m);
      // M.restore(m);
   }
);

</script>
